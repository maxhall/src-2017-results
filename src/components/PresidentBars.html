<div>
  <table>
    <thead>
      <th>Candidate</th>
      <th>Faction</th>
      <th>Votes</th>
      <th>Pct.</th>
    </thead>
    {{#each presSummary as presCandidate}}
      <tr>
        <td>{{presCandidate.candidate}}</td>
        <td>{{presCandidate.faction}}</td>
        <td>{{presCandidate.votes}}</td>
        <td>{{presCandidate.percent}}%</td>
        <td class="bar-wrapper">
          <span class="bar"
            style="width: {{presCandidate.barPercentage}}%; background-color: {{presCandidate.color}}">
          </span>
        </td>
      </tr>
    {{/each}}
  </table>
</div>

<style>
  table {
    width: 100%;
  }

  thead {
    text-align: left;
  }

  .bar-wrapper {
    display: table-cell;
    width: 40%;
  }

  .bar {
    display: block;
    position: relative;
    height: 10px;
    border-radius: 2px;
  }
</style>

<script>
  export default {
    computed: {
      presSummary: collatedResults => {
        const summaryObject = collatedResults.pres[10];
        const presResultArray = [];

        // Bella
        const pytkaSummary = {};
        pytkaSummary['candidate'] = 'Bella Pytka';
        pytkaSummary['faction'] = 'SLS (Labor Left)';
        pytkaSummary['votes'] = Number(summaryObject.pytka);
        pytkaSummary['percent'] = Number(summaryObject.pytkapercent) * 100;
        pytkaSummary['color'] = 'red';
        presResultArray.push(pytkaSummary);

        // Imogen
        const grantSummary = {};
        grantSummary['candidate'] = 'Imogen grant';
        grantSummary['faction'] = 'Grassroots';
        grantSummary['votes'] = Number(summaryObject.grant);
        grantSummary['percent'] = Number(summaryObject.grantpercent) * 100;
        grantSummary['color'] = 'green';
        presResultArray.push(grantSummary);

        // Brendan
        const maSummary = {};
        maSummary['candidate'] = 'Brendan Ma';
        maSummary['faction'] = 'Liberal';
        maSummary['votes'] = Number(summaryObject.ma);
        maSummary['percent'] = Number(summaryObject.mapercent) * 100;
        maSummary['color'] = 'blue';
        presResultArray.push(maSummary);

        // Informal
        const informalSummary = {};
        informalSummary['candidate'] = 'Informal';
        informalSummary['faction'] = '-';
        informalSummary['votes'] = Number(summaryObject.informal);
        informalSummary['percent'] = Number(summaryObject.informalpercent) * 100;
        informalSummary['color'] = 'grey';
        presResultArray.push(informalSummary);

        // Sort the array by the highest vote count
        presResultArray.sort((a, b) => {
          return b.votes - a.votes;
        });

        // Add the bar percentage
        presResultArray.map(candidateSummary => {
          const barPercentage = (candidateSummary.votes / presResultArray[0].votes) * 100;
          candidateSummary['barPercentage'] = barPercentage;
          return candidateSummary;
        })

        return presResultArray;
      },
    },
  }
</script>
