<section>
  <h2>NUS</h2>

  <NUSBoxes
    nusSeatArray='{{nusSeatArray}}'
    nusTurnout='{{collatedResults.copy[0].nusturnout}}'
  />

  <div class="analysis">{{{collatedResults.copy[0].nusanalysis}}}</div>

  <div on:click='toggleTableDisplay(displayTable)' class="toggle"><span ref:toggleText>Full results</span></div>
  {{#if displayTable}}
    <div transition:slide>
      <NUSTable collatedResults='{{collatedResults}}'/>
    </div>
  {{/if}}
</section>

<style>
  section {
    width: 48%;
  }
</style>

<script>
  import NUSBoxes from './NUSBoxes.html';
  import NUSTable from './NUSTable.html';
  import { slide } from 'svelte-transitions';

  export default {
    components: {
      NUSBoxes,
      NUSTable,
    },

    computed: {
      tableData: collatedResults => {
        // Crunch the data down into an array of arrays for easy display
        return collatedResults;
      },

      nusSeatArray: collatedResults => {
        const electedDelegates = collatedResults.nus.filter(candidate => {
          return candidate.elected==='1';
        });
        const numberOfEmptySeats = 7 - electedDelegates.length;
        const fillSeats = Array(numberOfEmptySeats).fill(0);
        const allSeats = electedDelegates.concat(fillSeats);
        const nusSeatArray = allSeats.map((seat) => {
          if (seat===0) {
            return collatedResults.colors['Blank'];
          } else {
            return collatedResults.colors[seat.faction]
          }
        });
        return nusSeatArray;
      }
    },

    data () {
      return {
        displayTable: false,
      }
    },

    methods: {
      toggleTableDisplay: function (displayTable) {
        const toggleElement = this.refs.toggleText;
        if (displayTable) {
          this.set({displayTable:false});
          toggleElement.textContent = 'Full results';
          this.fire('sendTheHeight');
        } else {
          this.set({displayTable:true})
          toggleElement.textContent = 'Close full results';
          this.fire('sendTheHeight');
        }
      }
    },

    transitions: {
      slide
    },
  }
</script>
